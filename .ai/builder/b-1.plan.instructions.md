# Constructor: Instrucciones para la planificación de funcionalidades

## Rol

Actúa como arquitecto de software para definir el documento del **plan de contenedor de funcionalidades** para una funcionalidad específica en un contenedor específico.

## Proceso

1. **Configuración de la plantilla**

- Lee la [Sintaxis de la plantilla](../syntax.template.md) para comprender cómo usarla.
- Lee y sigue el contenido y las instrucciones de la [Plantilla de plan de funcionalidades](./b-1.plan.template.md).

2. **Recopilación de información**

<!--
containerFolder: /{{ container.slug }}
Este será la raíz del contenedor. Úsalo como atajo.
Dentro habrá carpetas más específicas para docs, features, reglas de IA, etc.
-->

- Estas instrucciones se aplican a una sola funcionalidad a la vez.
- Lista de funcionalidades de una de las siguientes fuentes:
- Utiliza las herramientas de GitHub MCP para encontrar la incidencia de la funcionalidad.
- Elige la primera funcionalidad en estado "definido".
- Este documento se basa en el conocimiento del LLM y las reglas del proyecto.

**Pregunta obligatoria sobre Capa de Presentación**:
- **DEBES preguntar explícitamente**: "¿Quieres que se implemente la capa de presentación (interfaz de usuario) para esta funcionalidad?"
- Esta pregunta debe hacerse al inicio del proceso de planificación, antes de definir las tareas.
- Si la definición de la feature ya indica que no requiere UI (sección UI/UX con "No aplica"), puedes confirmar con el usuario: "La definición de la feature indica que no requiere interfaz de usuario. ¿Confirmas que no necesitas capa de presentación?"
- Si el usuario responde que SÍ quiere capa de presentación:
  - **DEBES sugerir el stack tecnológico adecuado** basándote en:
    - El stack tecnológico actual del proyecto (revisa archivos de configuración, dependencias, estructura del proyecto)
    - Las convenciones y patrones ya establecidos en el proyecto
    - Las mejores prácticas para el tipo de aplicación
  - Presenta la sugerencia de forma clara: "Para la capa de presentación, sugiero usar [stack tecnológico] porque [razones basadas en el proyecto actual]"
  - Si el proyecto ya tiene una capa de presentación implementada, sugiere usar la misma tecnología para mantener consistencia
  - Si es un proyecto nuevo o no tiene capa de presentación, sugiere opciones apropiadas basándote en el tipo de aplicación (web, móvil, escritorio)
  - Permite que el usuario confirme o modifique la sugerencia
  - Una vez confirmado el stack, incluye tareas específicas para la capa de Presentación en el plan usando la tecnología acordada
- Si el usuario responde que NO quiere capa de presentación, omite la capa de Presentación del plan y enfócate solo en las capas de backend/API.

3. **Resultado**

- El contenido de Markdown se guarda en un fichero de la carpeta `./docs/features/{{feature.slug}}/plan.md`

**Criterios de Validación** (ver [QUALITY_GATES.md](../QUALITY_GATES.md#gate-4-implementation-plan-completion)):
- Plan descompone la feature en tareas discretas e implementables
- Tareas están ordenadas por dependencias
- Cada tarea tiene criterios de aceptación claros
- Complejidad de tareas estimada
- Dependencias entre tareas identificadas
- Riesgos y mitigaciones documentados
- Patrones arquitectónicos requeridos identificados
- Plan sigue convenciones y patrones del proyecto
- Si la feature tiene interfaz de usuario, incluye tareas para la capa de Presentación (templates, vistas, componentes UI, formularios, etc.)
- Si se incluye capa de Presentación, el stack tecnológico está documentado en la sección "Stack Tecnológico - Capa de Presentación"
- Si la feature es solo API/backend, puede omitir la capa de Presentación

4. **Seguimiento**

- Utilizar las herramientas de MCP para actualizar la incidencia de GitHub para la funcionalidad.
  - Cambiar el estado de la incidencia de la funcionalidad a `builder-planned`
  - Añadir un comentario con contenido del plan
- Cambiar el estado de la incidencia de la funcionalidad a `builder-planned`
- Añadir enlace a la incidencia de plan en la sección de funcionalidades del archivo `docs/PRD.md` y `docs/PRD-es.md`, y agregar un enlace al documento del plan.
- Confirmar los cambios utilizando el siguiente formato convencional de mensaje de confirmación:
  - `docs: Plan de funcionalidad para {{feature.slug}} #<issue-number>`
